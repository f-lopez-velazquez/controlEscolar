<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Resetear y Reorganizar Base de Datos</title>
  <!-- Incluye Firebase (compat) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    h1 { color: #003366; }
    button { padding: 10px 15px; font-size: 1em; border: none; border-radius: 4px; background: #dc3545; color: #fff; cursor: pointer; }
  </style>
</head>
<body>
  <h1>Resetear Base de Datos y Reorganizar Estructura</h1>
  <p>Este proceso borrará todos los documentos en las colecciones "subjects", "students" y "teams".</p>
  <button id="resetBtn">Resetear Base de Datos</button>

  <script>
    // Configuración de Firebase (usa tus propios datos)
    const firebaseConfig = {
      apiKey: "AIzaSyC2VXIvR-OzF4iLlt8C69zt-cY1ZI_YhVo",
      authDomain: "paginaesco.firebaseapp.com",
      projectId: "paginaesco",
      storageBucket: "paginaesco.firebasestorage.app",
      messagingSenderId: "488675130286",
      appId: "1:488675130286:web:003debfbff0b1f3ee7a63f"
    };

    // Inicializar Firebase y Firestore
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Función para borrar todos los documentos de una colección
    async function deleteCollection(collectionName) {
      const collectionRef = db.collection(collectionName);
      const snapshot = await collectionRef.get();
      if (snapshot.empty) {
        console.log(`La colección "${collectionName}" ya está vacía.`);
        return;
      }
      const batch = db.batch();
      snapshot.docs.forEach(doc => {
        batch.delete(doc.ref);
      });
      await batch.commit();
      console.log(`Colección "${collectionName}" borrada.`);
    }

    // Función para reiniciar la base de datos: borrar documentos y reorganizar estructura
    async function resetDatabase() {
      if (!confirm("¿Estás seguro de que deseas REINICIAR la base de datos? Esta acción borrará TODOS los registros.")) {
        return;
      }
      try {
        await deleteCollection("subjects");
        await deleteCollection("students");
        await deleteCollection("teams");
        // Aquí podrías crear documentos "base" (vacíos) si lo deseas, por ejemplo:
        // db.collection("subjects").doc("circuitos").set({ name: "", semester: "", year: 0, rubric: {}, parcials: {} });
        // (Pero en este ejemplo dejamos las colecciones vacías para que luego se ingresen nuevos datos)
        console.log("Base de datos reiniciada y estructura reorganizada.");
        alert("La base de datos ha sido reiniciada. Ahora está lista para que ingreses la nueva estructura.");
      } catch (error) {
        console.error("Error reiniciando la base de datos:", error);
        alert("Hubo un error al reiniciar la base de datos. Revisa la consola para más detalles.");
      }
    }

    document.getElementById("resetBtn").addEventListener("click", resetDatabase);
  </script>
</body>
</html>
